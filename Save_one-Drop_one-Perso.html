<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="images/icone.png">
    <title>Save one Drop one IMPOSSIBLE</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
<header>
    <h1><span class="color1">K-Pop</span> <span class="color2">Website</span></h1><br>
    <h2 class="subtitle">Save one Drop one <span style="color:#FF0000;">IMPOSSIBLE</span></h2>
</header>

<style>
/* Volume + texte */
#texte {
    justify-content: center;
    align-items: center;
    display: flex;
}

/* Conteneur principal des vidéos */
#challenge-section {
    height: auto;
    width: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
    flex-direction: column; /* Aligne les éléments verticalement */
    position: relative;
    z-index: 1; /* En dessous du nav */
    padding-top: 40px; /* Espace sous le nav */
}

/* Vidéo simple (mode 1 ou 2) */
.single-video {
    width: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
    margin-top: 40px;
}

.single-video video {
    width: 90%;
    height: auto; /* Maintient le ratio 16:9 automatiquement */
    max-width: 90vw;
    max-height: 90vh;
    border-radius: 8px;
}

/* Mode 2 vidéos */
#dual-videos {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 5%;
    width: 100%;
    margin-top: 40px;
}

#dual-videos video {
    width: 30%;
    height: auto;
    cursor: pointer;
}

#dual-videos.hidden {
    display: none;
}

/* Conteneur YouTube */
#video-container-YT {
    height: 100%;
    width: 100%;
}

#version1 {
    display: block;
}

/* Vidéos YouTube et contenu par onglet */
.version-content {
    display: none;
    margin-top: 20px;
    width: 90%;
    height: 90%;
}

.version-content.active {
    display: block;
    width: 90%;
}

video {
    margin-bottom: 5%;
}

iframe {
    height: 100%;
    width: 100%;
}

/* Onglets */
.tabs {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    margin-bottom: 20px;
    margin-top: 20px;
}

.tab {
    background-color: #666;
    color: white;
    padding: 10px 15px;
    margin: 5px;
    cursor: pointer;
    border-radius: 5px;
}

.tab:hover {
    background-color: #888;
}

.tab-separateur {
    background-color: #fff;
    margin: 5px;
    padding: 1px;
    border-radius: 5px;
    border-color: #fff;
}

/* Masquer les contrôles superflus */
video::-webkit-media-controls-volume-slider {
    display: none;
}

video::-webkit-media-controls-mute-button {
    display: none;
}

video::-internal-media-controls-overlay-cast-button {
    display: none;
}

video::-webkit-media-controls-enclosure {
    overflow: hidden;
}
    
#profil-selection {
    margin: 60px auto; /* marge verticale + centrage horizontal */
    padding: 30px; /* marges intérieures pour que les éléments respirent */
    display: flex;
    flex-wrap: wrap;
    justify-content: center; /* centrer horizontalement le contenu */
    gap: 20px;
    width: fit-content; /* taille automatique selon le contenu */
    border-radius: 6px;
    background-color: #111;
    border: 1px solid #333;
    box-shadow: 0 0 10px rgba(0,0,0,0.5); /* optionnel, pour un effet visuel */
}


#profil-selection label {
    color: white;
    font-size: 2em;
    font-weight: bold;
    margin-right: 10px;
}

#profil-selection select {
    background-color: #000;
    color: #FFF;
    border: 1px solid #00C5D5;
    border-radius: 4px;
    font-size: 1.5em;
    padding: 10px 15px;
    transition: all 0.3s ease;
}


/* Conteneur du toggle */
#mode-rapide-container {
    display: flex;
    align-items: center;
    justify-content: center;
    margin-top: 20px;
    gap: 10px;
}

/* Texte du mode */
.mode-label {
    color: #FFFFFF;
    font-size: 1.5em;
    font-weight: bold;
}

/* Toggle switch style */
.switch {
    position: relative;
    display: inline-block;
    width: 60px;
    height: 34px;
}

.switch input {
    opacity: 0;
    width: 0;
    height: 0;
}

/* Slider ON/OFF */
.slider {
    position: absolute;
    cursor: pointer;
    top: 0; left: 0;
    right: 0; bottom: 0;
    background-color: #8A6ACE;
    transition: .4s;
    border-radius: 34px;
}

.slider:before {
    position: absolute;
    content: "";
    height: 26px;
    width: 26px;
    left: 4px;
    bottom: 4px;
    background-color: white;
    transition: .4s;
    border-radius: 50%;
}

input:checked + .slider {
    background-color: #00C5D5;
}

input:checked + .slider:before {
    transform: translateX(26px);
}


</style>

<section style="width: 100%;">
    <div id="nav-container"></div>

    <!-- Sélection du profil -->
    <div id="profil-selection" style="text-align: center; margin-top: 30px;">
        <label for="profil">Qui es-tu ? </label>
        <select id="profil">
            <option value="">-- Sélectionne ton profil --</option>
            <option value="Andy">Andy</option>
            <option value="Anna">Anna</option>
            <option value="Gwenola">Gwenola</option>
            <option value="Laurana">Laurana</option>
            <option value="Melyssa">Melyssa</option>
            <option value="Testeur">Testeur</option>
        </select>
    </div>

    <!-- Bouton Mode rapide -->
    <div id="mode-rapide-container">
        <span class="mode-label">Mode normal</span>
        <label class="switch">
            <input type="checkbox" id="toggleModeRapide">
            <span class="slider"></span>
        </label>
        <span class="mode-label">Mode rapide</span>
    </div>


    <!-- Barre latérale -->
    <div id="sidebar">
        <h3>Volume Global</h3>
        <input type="range" id="globalVolume" min="0" max="100" step="1">
        <span id="volumeValue"></span>
    </div>
</section>

<section id="challenge-section">
    <div id="single-video" class="single-video hidden">
        <video width="1440" height="810" id="videoA" controls></video>
    </div>

    <div id="second-video" class="single-video hidden">
        <video width="1440" height="810" id="videoB" controls></video>
    </div>

    <div id="dual-videos" class="video-container hidden">
        <video id="choiceA" width="320" height="180" muted autoplay loop></video>
        <video id="choiceB" width="320" height="180" muted autoplay loop></video>
    </div>
</section>

<script src="./JS_commun.js"></script>

<script>
let liste_0 = [], liste_5 = [], liste_10 = [], liste_15 = [], liste_20 = [];
let liste_25 = [], liste_30 = [], liste_35 = [], liste_40 = [], liste_45 = [];
let liste_50 = [], liste_55 = [], liste_60 = [], liste_65 = [], liste_70 = [];
let liste_75 = [], liste_80 = [], liste_85 = [], liste_90 = [], liste_95 = [];
let liste_100 = [], liste_105 = [];

const allLists = {
    liste_0, liste_5, liste_10, liste_15, liste_20,
    liste_25, liste_30, liste_35, liste_40, liste_45,
    liste_50, liste_55, liste_60, liste_65, liste_70,
    liste_75, liste_80, liste_85, liste_90, liste_95,
    liste_100, liste_105
};

let firstVideo = '';
let secondVideo = '';

document.getElementById('profil').addEventListener('change', async function () {
    const profil = this.value;
    if (!profil) return;

    const chemin = `./Donnees_CSV/Listes-Save_one-Drop_one/${profil}.json`;
    try {
        const response = await fetch(chemin);
        const data = await response.json();

        // Charger toutes les listes dans les variables
        for (let i = 0; i <= 105; i += 5) {
            let key = `liste_${i}`;
            if (data[key]) {
                allLists[key] = [...data[key]]; // copier la liste
            } else {
                allLists[key] = [];
            }
        }

        // Lancer le challenge
        startChallenge();
    } catch (e) {
        console.error("Erreur lors du chargement du JSON :", e);
        alert("Impossible de charger les vidéos pour ce profil.");
    }
});

function getRandomNonEmptyList() {
    const nonEmptyLists = Object.entries(allLists).filter(([_, liste]) => liste.length >= 2);
    if (nonEmptyLists.length === 0) return null;

    const [key, liste] = nonEmptyLists[Math.floor(Math.random() * nonEmptyLists.length)];
    return { key, liste };
}
    
let modeRapide = false; // état du bouton

document.getElementById('toggleModeRapide').addEventListener('change', function () {
    modeRapide = this.checked;
});
    
function startChallenge() {
    cleanupVideos();

    const selection = getRandomNonEmptyList();
    if (!selection) {
        alert("Bravo ! Tu as terminé toutes les vidéos !");
        return;
    }

    const { key, liste } = selection;

    // Sélectionner deux vidéos aléatoires
    const indices = [];
    while (indices.length < 2) {
        const i = Math.floor(Math.random() * liste.length);
        if (!indices.includes(i)) indices.push(i);
    }

    firstVideo = liste[indices[0]];
    secondVideo = liste[indices[1]];

    // Supprimer les vidéos de la liste
    allLists[key] = liste.filter((_, idx) => !indices.includes(idx));

    // MODE RAPIDE ACTIVÉ : passer directement aux petites vidéos
    if (modeRapide) {
        document.getElementById('dual-videos').classList.remove('hidden');
        choiceA.src = './videos/' + firstVideo;
        choiceB.src = './videos/' + secondVideo;
        choiceA.play();
        choiceB.play();
        return;
    }

    // Mode normal
    const singleContainer = document.getElementById('single-video');
    const videoA = document.getElementById('videoA');
    singleContainer.classList.remove('hidden');
    videoA.src = './videos/' + firstVideo;
    videoA.play();

    videoA.onended = () => {
        videoA.pause();
        singleContainer.classList.add('hidden');

        const secondContainer = document.getElementById('second-video');
        const videoB = document.getElementById('videoB');
        secondContainer.classList.remove('hidden');
        videoB.src = './videos/' + secondVideo;
        videoB.play();

        videoB.onended = () => {
            videoB.pause();
            secondContainer.classList.add('hidden');

            // Montrer les petites vidéos
            document.getElementById('dual-videos').classList.remove('hidden');
            choiceA.src = './videos/' + firstVideo;
            choiceB.src = './videos/' + secondVideo;
            choiceA.play();
            choiceB.play();
        };
    };
}

function cleanupVideos() {
    // Nettoyer les grosses vidéos
    const videoA = document.getElementById('videoA');
    const videoB = document.getElementById('videoB');
    videoA.pause(); videoA.src = '';
    videoB.pause(); videoB.src = '';

    document.getElementById('single-video').classList.add('hidden');
    document.getElementById('second-video').classList.add('hidden');

    // Nettoyer les vidéos de choix
    choiceA.pause(); choiceA.src = '';
    choiceB.pause(); choiceB.src = '';
    document.getElementById('dual-videos').classList.add('hidden');
}

choiceA.onclick = () => {
    cleanupChoices();
};

choiceB.onclick = () => {
    cleanupChoices();
};

function cleanupChoices() {
    cleanupVideos();
    startChallenge();
}

let hoverTimeoutA, hoverTimeoutB;

choiceA.addEventListener('mouseenter', () => {
    hoverTimeoutA = setTimeout(() => {
        choiceA.muted = false;
    }, 1000);
});
choiceA.addEventListener('mouseleave', () => {
    clearTimeout(hoverTimeoutA);
    choiceA.muted = true;
});

choiceB.addEventListener('mouseenter', () => {
    hoverTimeoutB = setTimeout(() => {
        choiceB.muted = false;
    }, 1000);
});
choiceB.addEventListener('mouseleave', () => {
    clearTimeout(hoverTimeoutB);
    choiceB.muted = true;
});
</script>

</body>
</html>
