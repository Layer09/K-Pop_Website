<!DOCTYPE html>
 <html lang="fr">
 <head>
     <meta charset="UTF-8">
     <meta name="viewport" content="width=device-width, initial-scale=1.0">
     <link rel="icon" type="image/png" href="images/icone.png">
     <title>K-Pop Website</title>
     <link rel="stylesheet" href="style.css">
     <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
     <style>
      #filters {
          display: flex;
          flex-wrap: wrap;
          margin: 20px;
          gap: 10px;
      }
      .filter {
          display: flex;
          flex-direction: column;
      }
      .video-grid {
          display: grid;
          grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
          gap: 20px;
          margin: 20px;
      }
      .video-card {
          border: 1px solid #ccc;
          padding: 10px;
          background: #fdfdfd;
          border-radius: 6px;
      }
      .video-card video {
          width: 100%;
          border-radius: 4px;
          cursor: pointer;
      }
      .video-info {
          font-size: 0.9em;
          margin-top: 10px;
      }
      
      /* Modale */
      .modal {
          position: fixed;
          top: 0;
          left: 0;
          right:0;
          bottom:0;
          background-color: rgba(0, 0, 0, 0.85);
          display: flex;
          align-items: center;
          justify-content: center;
          z-index: 1000;
      }
      .modal.hidden {
          display: none;
      }
      .modal-content {
          position: relative;
          max-width: 90%;
          max-height: 90%;
      }
      .modal-content video {
          width: 100%;
          height: auto;
      }
      #close-modal {
          position: absolute;
          top: 10px;
          right: 20px;
          font-size: 2rem;
          color: white;
          cursor: pointer;
      }
      
      #pagination {
          display: flex;
          justify-content: center;
          gap: 8px;
          margin: 20px 0;
          flex-wrap: wrap;
      }
      
      #pagination button {
          padding: 6px 10px;
          background-color: #eee;
          border: 1px solid #ccc;
          border-radius: 4px;
          cursor: pointer;
      }
      
      #pagination button:disabled {
          background-color: #ccc;
          cursor: default;
      }
      
      #pagination span {
          padding: 6px 10px;
          color: #777;
      }

     </style>
 </head>
 <body>
     <header>
         <h1><span class="color1">K-Pop</span> <span class="color2">Website</span></h1>
         <h2 class="subtitle">Accueil</h2>
     </header>
     <div id="nav-container"></div>
     <!-- Barre latérale -->
     <div id="sidebar">
         <h3>Volume Global</h3>
         <input type="range" id="globalVolume" min="0" max="100" step="1">
         <span id="volumeValue"></span>
     </div>

       <!-- Filtres dynamiques -->
     <div id="filters"></div>
     
     <!-- Conteneur des vidéos -->
     <div id="video-grid" class="video-grid"></div>
     
     <!-- Modale de lecture vidéo en grand -->
     <div id="video-modal" class="modal hidden">
         <div class="modal-content">
             <span id="close-modal">&times;</span>
             <video id="modal-video" controls autoplay></video>
         </div>
     </div>
  
     <!-- Pagination (sera rempli dynamiquement) -->
     <div id="pagination"></div>


     <script src="./Donnees_CSV/stats.js"></script>
     <script src="./JS_commun.js"></script>
     <script src="./videos/liste_video.js"></script>

     <script>
      document.addEventListener('DOMContentLoaded', () => {
         const csvPath = './Donnees_CSV/Infos.csv';
         const videoFolder = './videos/';
         const videoGrid = document.getElementById('video-grid');
         const filtersContainer = document.getElementById('filters');
     
         const MAX_PER_PAGE = 50;
         let currentPage = 1;
         let allData = [];
         let filteredData = [];
     
         // Chargement CSV
         Papa.parse(csvPath, {
             download: true,
             header: true,
             complete: function(results) {
                 allData = results.data.filter(row => row.Nombre); // ignore les lignes vides
                 filteredData = allData;
                 createFilters(allData);
                 displayVideos(allData, 1);
             }
         });
     
         function createFilters(data) {
             const columns = Object.keys(data[0]);
             columns.forEach(col => {
                 const values = [...new Set(data.map(row => row[col]).filter(Boolean))].sort();
                 const select = document.createElement('select');
                 select.id = `filter-${col}`;
                 const label = document.createElement('label');
                 label.textContent = col + " : ";
                 select.innerHTML = `<option value="">-- Tous --</option>`;
                 values.forEach(val => {
                     const option = document.createElement('option');
                     option.value = val;
                     option.textContent = val;
                     select.appendChild(option);
                 });
                 select.addEventListener('change', () => filterVideos());
                 const wrapper = document.createElement('div');
                 wrapper.className = "filter";
                 wrapper.appendChild(label);
                 wrapper.appendChild(select);
                 filtersContainer.appendChild(wrapper);
             });
         }
     
         function displayVideos(data, page = 1) {
             videoGrid.innerHTML = "";
             currentPage = page;
     
             filteredData = data;
             const totalPages = Math.ceil(data.length / MAX_PER_PAGE);
             const start = (page - 1) * MAX_PER_PAGE;
             const end = start + MAX_PER_PAGE;
             const videosToShow = data.slice(start, end);
     
             videosToShow.forEach((video, i) => {
                 const index = parseInt(video.Nombre, 10) - 1;
                 const filename = videoList[index];
                 if (!filename) return; // Sécurité
     
                 const card = document.createElement('div');
                 card.className = 'video-card';
     
                 const videoElement = document.createElement('video');
                 videoElement.src = videoFolder + filename;
                 videoElement.controls = false;
                 videoElement.muted = true;
                 videoElement.loop = true;
                 videoElement.autoplay = true;
     
                 videoElement.addEventListener('click', () => openModal(videoFolder + filename));
     
                 const info = document.createElement('div');
                 info.className = 'video-info';
                 Object.entries(video).forEach(([key, value]) => {
                     const p = document.createElement('p');
                     p.innerHTML = `<strong>${key}</strong> : ${value}`;
                     info.appendChild(p);
                 });
     
                 card.appendChild(videoElement);
                 card.appendChild(info);
                 videoGrid.appendChild(card);
             });
     
             renderPaginationControls(totalPages);
         }
     
         function renderPaginationControls(totalPages) {
             const existing = document.getElementById('pagination');
             if (existing) existing.remove();
     
             const pagination = document.createElement('div');
             pagination.id = 'pagination';
     
             if (currentPage > 1) {
                 const prevBtn = document.createElement('button');
                 prevBtn.textContent = '← Précédent';
                 prevBtn.onclick = () => displayVideos(filteredData, currentPage - 1);
                 pagination.appendChild(prevBtn);
             }
     
             for (let i = 1; i <= totalPages; i++) {
                 if (
                     i === currentPage ||
                     i === 1 ||
                     i === totalPages ||
                     Math.abs(i - currentPage) <= 2
                 ) {
                     const pageBtn = document.createElement('button');
                     pageBtn.textContent = i;
                     pageBtn.disabled = i === currentPage;
                     pageBtn.onclick = () => displayVideos(filteredData, i);
                     pagination.appendChild(pageBtn);
                 } else if (
                     (i === currentPage - 3 || i === currentPage + 3) &&
                     totalPages > 5
                 ) {
                     const dots = document.createElement('span');
                     dots.textContent = '...';
                     pagination.appendChild(dots);
                 }
             }
     
             if (currentPage < totalPages) {
                 const nextBtn = document.createElement('button');
                 nextBtn.textContent = 'Suivant →';
                 nextBtn.onclick = () => displayVideos(filteredData, currentPage + 1);
                 pagination.appendChild(nextBtn);
             }
     
             videoGrid.parentNode.appendChild(pagination);
         }
     
         function filterVideos() {
             const filters = Array.from(filtersContainer.querySelectorAll('select'));
             let filtered = allData;
     
             filters.forEach(select => {
                 const col = select.id.replace('filter-', '');
                 const val = select.value;
                 if (val) {
                     filtered = filtered.filter(row => row[col] === val);
                 }
             });
     
             displayVideos(filtered, 1); // Repartir de la première page
         }
     
         // Modale
         const modal = document.getElementById('video-modal');
         const modalVideo = document.getElementById('modal-video');
         const closeModalBtn = document.getElementById('close-modal');
     
         function openModal(src) {
             modal.classList.remove('hidden');
             modalVideo.src = src;
             modalVideo.play();
         }
     
         closeModalBtn.addEventListener('click', () => {
             modal.classList.add('hidden');
             modalVideo.pause();
             modalVideo.src = "";
         });
     });

     </script>
 </body>
 </html>
