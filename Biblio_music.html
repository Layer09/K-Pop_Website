<!DOCTYPE html>
 <html lang="fr">
 <head>
     <meta charset="UTF-8">
     <meta name="viewport" content="width=device-width, initial-scale=1.0">
     <link rel="icon" type="image/png" href="images/icone.png">
     <title>K-Pop Website</title>
     <link rel="stylesheet" href="style.css">
     <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
     <style>
      #filters {
          display: flex;
          flex-wrap: wrap;
          margin: 20px;
          gap: 10px;
      }
      .filter {
          display: flex;
          flex-direction: column;
      }
      .video-grid {
          display: grid;
          grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
          gap: 20px;
          margin: 20px;
      }
      .video-card {
          border: 1px solid #ccc;
          padding: 10px;
          background: #fdfdfd;
          border-radius: 6px;
      }
      .video-card video {
          width: 100%;
          border-radius: 4px;
          cursor: pointer;
      }
      .video-info {
          font-size: 0.9em;
          margin-top: 10px;
      }
      
      /* Modale */
      .modal {
          position: fixed;
          top: 0;
          left: 0;
          right:0;
          bottom:0;
          background-color: rgba(0, 0, 0, 0.85);
          display: flex;
          align-items: center;
          justify-content: center;
          z-index: 1000;
      }
      .modal.hidden {
          display: none;
      }
      .modal-content {
          position: relative;
          max-width: 90%;
          max-height: 90%;
      }
      .modal-content video {
          width: 100%;
          height: auto;
      }
      #close-modal {
          position: absolute;
          top: 10px;
          right: 20px;
          font-size: 2rem;
          color: white;
          cursor: pointer;
      }

     </style>
 </head>
 <body>
     <header>
         <h1><span class="color1">K-Pop</span> <span class="color2">Website</span></h1>
         <h2 class="subtitle">Accueil</h2>
     </header>
     <div id="nav-container"></div>
     <!-- Barre latérale -->
     <div id="sidebar">
         <h3>Volume Global</h3>
         <input type="range" id="globalVolume" min="0" max="100" step="1">
         <span id="volumeValue"></span>
     </div>

       <!-- Filtres dynamiques -->
     <div id="filters"></div>
     
     <!-- Conteneur des vidéos -->
     <div id="video-grid" class="video-grid"></div>
     
     <!-- Modale de lecture vidéo en grand -->
     <div id="video-modal" class="modal hidden">
         <div class="modal-content">
             <span id="close-modal">&times;</span>
             <video id="modal-video" controls autoplay></video>
         </div>
     </div>

     <script src="./Donnees_CSV/stats.js"></script>
     <script src="./JS_commun.js"></script>
     <script src="./videos/liste_video.js"></script>

     <script>
      document.addEventListener('DOMContentLoaded', () => {
           const csvPath = './Donnees_CSV/Infos.csv';
           const videoFolder = './videos/';
           const videoGrid = document.getElementById('video-grid');
           const filtersContainer = document.getElementById('filters');
       
           let allData = [];
       
           // Chargement CSV
           Papa.parse(csvPath, {
               download: true,
               header: true,
               complete: function(results) {
                   allData = results.data;
                   createFilters(allData);
                   displayVideos(allData);
               }
           });
       
           function createFilters(data) {
               const columns = Object.keys(data[0]);
               columns.forEach(col => {
                   const values = [...new Set(data.map(row => row[col]).filter(Boolean))].sort();
                   const select = document.createElement('select');
                   select.id = `filter-${col}`;
                   const label = document.createElement('label');
                   label.textContent = col + " : ";
                   select.innerHTML = `<option value="">-- Tous --</option>`;
                   values.forEach(val => {
                       const option = document.createElement('option');
                       option.value = val;
                       option.textContent = val;
                       select.appendChild(option);
                   });
                   select.addEventListener('change', () => filterVideos());
                   const wrapper = document.createElement('div');
                   wrapper.className = "filter";
                   wrapper.appendChild(label);
                   wrapper.appendChild(select);
                   filtersContainer.appendChild(wrapper);
               });
           }
       
           function displayVideos(data) {
               videoGrid.innerHTML = "";
               data.forEach(video => {
                   const filename = video.Nombre.padStart(3, '0') + '-' + video.Artiste.replace(/\s+/g, '_') + '-' + video.Titre.replace(/\s+/g, '_') + `-Ep${video.Episode}-` + video.Nombre.padStart(2, '0') + `.mp4`;
       
                   const card = document.createElement('div');
                   card.className = 'video-card';
       
                   const videoElement = document.createElement('video');
                   videoElement.src = videoFolder + filename;
                   videoElement.controls = false;
                   videoElement.muted = true;
                   videoElement.loop = true;
                   videoElement.autoplay = true;
       
                   videoElement.addEventListener('click', () => openModal(videoFolder + filename));
       
                   const info = document.createElement('div');
                   info.className = 'video-info';
                   Object.entries(video).forEach(([key, value]) => {
                       const p = document.createElement('p');
                       p.innerHTML = `<strong>${key}</strong> : ${value}`;
                       info.appendChild(p);
                   });
       
                   card.appendChild(videoElement);
                   card.appendChild(info);
                   videoGrid.appendChild(card);
               });
           }
       
           function filterVideos() {
               const filters = Array.from(filtersContainer.querySelectorAll('select'));
               let filtered = allData;
       
               filters.forEach(select => {
                   const col = select.id.replace('filter-', '');
                   const val = select.value;
                   if (val) {
                       filtered = filtered.filter(row => row[col] === val);
                   }
               });
       
               displayVideos(filtered);
           }
       
           // Modale
           const modal = document.getElementById('video-modal');
           const modalVideo = document.getElementById('modal-video');
           const closeModalBtn = document.getElementById('close-modal');
       
           function openModal(src) {
               modal.classList.remove('hidden');
               modalVideo.src = src;
               modalVideo.play();
           }
       
           closeModalBtn.addEventListener('click', () => {
               modal.classList.add('hidden');
               modalVideo.pause();
               modalVideo.src = "";
           });
       });

     </script>
 </body>
 </html>
