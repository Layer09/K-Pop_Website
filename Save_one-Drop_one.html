<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="images/icone.png">
    <title>Save one Drop one</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <h1><span class="color1">K-Pop</span> <span class="color2">Website</span></h1><br>
        <h2 class="subtitle">Save one Drop one</h2>

        <div id="user-menu">
            <div id="user-container">
                <a id="login-link" href="Login.html">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-right" viewBox="0 0 16 16">
                      <path fill-rule="evenodd" d="M6 3.5a.5.5 0 0 1 .5-.5h8a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-8a.5.5 0 0 1-.5-.5v-2a.5.5 0 0 0-1 0v2A1.5 1.5 0 0 0 6.5 14h8a1.5 1.5 0 0 0 1.5-1.5v-9A1.5 1.5 0 0 0 14.5 2h-8A1.5 1.5 0 0 0 5 3.5v2a.5.5 0 0 0 1 0z"/>
                      <path fill-rule="evenodd" d="M11.854 8.354a.5.5 0 0 0 0-.708l-3-3a.5.5 0 1 0-.708.708L10.293 7.5H1.5a.5.5 0 0 0 0 1h8.793l-2.147 2.146a.5.5 0 0 0 .708.708z"/>
                    </svg>
                    Me connecter
                </a>
                <div id="user-info" class="hidden">
                    <img src="./images/Logo.png" alt="Icône utilisateur">
                    <span id="username-display"></span>
                    <div id="dropdown-menu" class="hidden">
                        <ul>
                            <li><a href="Save_one-Drop_one-Perso.html">Mon Save One Drop One</a></li>
                            <li><a href="Statistiques-Perso.html">Mes statistiques</a></li>
                            <hr>
                            <li id="logout">Me déconnecter</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </header>
    
    <style>
/* Volume + texte */
#youtube-section h3 {
    color: white;
    margin-bottom: 20px;
    font-size: x-large;
}

#texte {
    justify-content: center;
    align-items: center;
    display: flex;
}

/* Conteneur principal des vidéos */
#challenge-section {
    height: auto;
    width: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
    flex-direction: column; /* Aligne les éléments verticalement */
    position: relative;
    z-index: 1; /* En dessous du nav */
    padding-top: 40px; /* Espace sous le nav */
}

/* Vidéo simple (mode 1 ou 2) */
.single-video {
    width: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
    margin-top: 40px;
}

.single-video video {
    width: 90%;
    height: auto; /* Maintient le ratio 16:9 automatiquement */
    max-width: 90vw;
    max-height: 90vh;
    border-radius: 8px;
}

/* Mode 2 vidéos */
#dual-videos {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 5%;
    width: 100%;
    margin-top: 40px;
}

#dual-videos video {
    width: 30%;
    height: auto;
    cursor: pointer;
}

#dual-videos.hidden {
    display: none;
}

/* Conteneur YouTube */
#video-container-YT {
    height: 100%;
    width: 100%;
}

#version1 {
    display: block;
}

/* Vidéos YouTube et contenu par onglet */
.version-content {
    display: none;
    margin-top: 20px;
    width: 90%;
    height: 90%;
}

.version-content.active {
    display: block;
    width: 90%;
}

iframe {
    height: 100%;
    width: 100%;
}

/* Onglets */
.tabs {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    margin-bottom: 20px;
    margin-top: 20px;
}

.tab {
    background-color: #666;
    color: white;
    padding: 10px 15px;
    margin: 5px;
    cursor: pointer;
    border-radius: 5px;
}

.tab:hover {
    background-color: #888;
}

.tab-separateur {
    background-color: #fff;
    margin: 5px;
    padding: 1px;
    border-radius: 5px;
    border-color: #fff;
}

/* Masquer les contrôles superflus */
video::-webkit-media-controls-volume-slider {
    display: none;
}

video::-webkit-media-controls-mute-button {
    display: none;
}

video::-internal-media-controls-overlay-cast-button {
    display: none;
}

video::-webkit-media-controls-enclosure {
    overflow: hidden;
}

/* Responsive mobile */
@media (max-width: 1100px) {
    #challenge-section {
        height: auto;
        padding: 20px 0;
    }

    .single-video video {
        width: 95%;
    }

    #dual-videos video {
        width: 45%;
    }

    .youtube-section {
        height: auto;
        padding-bottom: 20px;
    }

    .youtube-section iframe {
        width: 95%;
    }
}
    /* Conteneur du toggle */
#mode-rapide-container {
    display: flex;
    align-items: center;
    justify-content: center;
    margin-top: 20px;
    gap: 10px;
}

/* Texte du mode */
.mode-label {
    color: #FFFFFF;
    font-size: 1.5em;
    font-weight: bold;
}

/* Toggle switch style */
.switch {
    position: relative;
    display: inline-block;
    width: 60px;
    height: 34px;
}

.switch input {
    opacity: 0;
    width: 0;
    height: 0;
}

/* Slider ON/OFF */
.slider {
    position: absolute;
    cursor: pointer;
    top: 0; left: 0;
    right: 0; bottom: 0;
    background-color: #8A6ACE;
    transition: .4s;
    border-radius: 34px;
}

.slider:before {
    position: absolute;
    content: "";
    height: 26px;
    width: 26px;
    left: 4px;
    bottom: 4px;
    background-color: white;
    transition: .4s;
    border-radius: 50%;
}

input:checked + .slider {
    background-color: #00C5D5;
}

input:checked + .slider:before {
    transform: translateX(26px);
}
    </style>
    <section style="width: 100%;">
    <div id="nav-container"></div>
        
    <!-- Bouton Mode rapide -->
    <div id="mode-rapide-container">
        <span class="mode-label">Mode normal</span>
        <label class="switch">
            <input type="checkbox" id="toggleModeRapide">
            <span class="slider"></span>
        </label>
        <span class="mode-label">Mode rapide</span>
    </div>
        
    <!-- Barre latérale -->
    <div id="sidebar">
        <h3>Volume Global</h3>
        <input type="range" id="globalVolume" min="0" max="100" step="1">
        <span id="volumeValue"></span>
    </div>
    </section>
<section id="challenge-section">
    <!-- Mode vidéo 1 -->
    <div id="single-video" class="single-video">
        <video width="1440" height="810" id="videoA" controls></video>
    </div>

    <!-- Mode vidéo 2 -->
    <div id="second-video" class="single-video hidden">
        <video width="1440" height="810" id="videoB" controls></video>
    </div>

    <!-- Mode deux vidéos pour le choix -->
    <div id="dual-videos" class="video-container hidden">
        <video id="choiceA" width="320" height="180" muted autoplay loop></video>
        <video id="choiceB" width="320" height="180" muted autoplay loop></video>
    </div>
</section>
    <script src="./JS_commun.js"></script>
    <script src="./videos/liste_video.js"></script>
    <script>
    let firstVideo = ''; 
    let secondVideo = '';
    let titresRestants = [...videoList];  // Initialise titresRestants avec une copie de videoList
    
    document.addEventListener("DOMContentLoaded", () => {
    
        function getRandomVideo(exclude = null) {
            // Si titresRestants est vide, réinitialiser à partir de videoList
            if (titresRestants.length === 0) {
                alert('Bravo ! Tu as fait un tour des musiques !');
                titresRestants = [...videoList];
            }
    
            let available = titresRestants.filter(v => v !== exclude);
            const randomIndex = Math.floor(Math.random() * available.length);
            const video = available[randomIndex];
    
            // Retirer la vidéo sélectionnée de titresRestants
            titresRestants = titresRestants.filter(v => v !== video);
    
            return video;
        }
    
        let modeRapide = false; // État du bouton

        document.getElementById('toggleModeRapide').addEventListener('change', function () {
            modeRapide = this.checked;
        });
        
        function startChallenge() {
            cleanupVideos();
        
            // Sélection aléatoire des deux vidéos
            firstVideo = getRandomVideo();
            secondVideo = getRandomVideo(firstVideo);
        
            // MODE RAPIDE ACTIVÉ : passer directement aux petites vidéos
            if (modeRapide) {
                document.getElementById('dual-videos').classList.remove('hidden');
                choiceA.src = './videos/' + firstVideo;
                choiceB.src = './videos/' + secondVideo;
                choiceA.play();
                choiceB.play();
                return;
            }
        
            // MODE NORMAL : lecture des deux grandes vidéos
            const singleContainer = document.createElement('div');
            singleContainer.id = 'single-video';
            singleContainer.classList.add('single-video');
            singleContainer.innerHTML = `<video width="720" height="405" id="videoA" controls></video>`;
            document.body.appendChild(singleContainer);
        
            let videoA = document.getElementById('videoA');
            videoA.src = './videos/' + firstVideo;
            videoA.play();
        
            videoA.onended = () => {
                videoA.pause();
                singleContainer.remove();
        
                const secondContainer = document.createElement('div');
                secondContainer.id = 'second-video';
                secondContainer.classList.add('single-video');
                secondContainer.innerHTML = `<video width="720" height="405" id="videoB" controls></video>`;
                document.body.appendChild(secondContainer);
        
                let videoB = document.getElementById('videoB');
                videoB.src = './videos/' + secondVideo;
                videoB.play();
        
                videoB.onended = () => {
                    videoB.pause();
                    secondContainer.remove();
        
                    document.getElementById('dual-videos').classList.remove('hidden');
                    choiceA.src = './videos/' + firstVideo;
                    choiceB.src = './videos/' + secondVideo;
                    choiceA.play();
                    choiceB.play();
                };
            };
        }

        function cleanupVideos() {
            // Vérifie si un conteneur vidéo existe déjà et le supprime
            let oldSingleVideo = document.getElementById('single-video');
            let oldSecondVideo = document.getElementById('second-video');
    
            if (oldSingleVideo) oldSingleVideo.remove();
            if (oldSecondVideo) oldSecondVideo.remove();
    
            // Supprime aussi les vidéos petites (si elles existent déjà)
            let choiceA = document.getElementById('choiceA');
            let choiceB = document.getElementById('choiceB');
    
            if (choiceA) {
                choiceA.pause();
                choiceA.setAttribute('disableRemotePlayback', true);
                choiceA.src = '';
            }
            if (choiceB) {
                choiceB.pause();
                choiceB.setAttribute('disableRemotePlayback', true);
                choiceB.src = '';
            }
    
            // Masquer la section de choix des petites vidéos
            document.getElementById('dual-videos').classList.add('hidden');
        }
    
        choiceA.onclick = () => {
            /* alert('Tu as choisi la première vidéo !'); */
            cleanupChoices();
        };
    
        choiceB.onclick = () => {
            /* alert('Tu as choisi la deuxième vidéo !'); */
            cleanupChoices();
        };
    
        function cleanupChoices() {
            // Arrêter les petites vidéos quand l'utilisateur fait un choix
            cleanupVideos();
    
            // Démarrer un nouveau challenge (vider les éléments et recharger)
            startChallenge();
        }
    
        let hoverTimeoutA;
        let hoverTimeoutB;
    
        choiceA.addEventListener('mouseenter', () => {
            hoverTimeoutA = setTimeout(() => {
                choiceA.muted = false;
                /* choiceA.volume = 0.1; */
            }, 1000);
        });
    
        choiceA.addEventListener('mouseleave', () => {
            clearTimeout(hoverTimeoutA);
            choiceA.muted = true;
        });
    
        choiceB.addEventListener('mouseenter', () => {
            hoverTimeoutB = setTimeout(() => {
                choiceB.muted = false;
                /* choiceB.volume = 0.1; */
            }, 1000);
        });
    
        choiceB.addEventListener('mouseleave', () => {
            clearTimeout(hoverTimeoutB);
            choiceB.muted = true;
        });
    
        window.onload = startChallenge;
    });

    function showVersion(version) {
        document.querySelectorAll('.version-content').forEach(div => {
            div.style.display = 'none';
        });
    
        let selectedVersion = document.getElementById('version' + version);
        if (selectedVersion) {
            selectedVersion.style.display = 'block';
        } else {
            console.error("Version introuvable : version" + version);
        }
    
        // Changer la couleur du bouton actif
        document.querySelectorAll('.tab').forEach(button => {
            button.style.backgroundColor = ""; // Réinitialise tous les boutons
        });
        if (version < 5) {
            document.querySelector(`.tab:nth-child(${version})`).style.backgroundColor = "#333333";
        } else {
            document.querySelector(`.tab:nth-child(${version + 1})`).style.backgroundColor = "#333333";
        }
    }
</script>
</body>
</html>
